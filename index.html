<!DOCTYPE html>
<html>
<head>
    <title>Thrissur Bus Route Search</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f4f4;
            padding: 20px;
        }
        .container {
            max-width: 500px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        h3 { text-align: center; margin-bottom: 20px; }
        .input-group { position: relative; margin-bottom: 15px; }
        input {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border-radius: 8px;
            border: 1px solid #ccc;
        }
        .dropdown {
            position: absolute;
            width: 100%;
            background: white;
            border: 1px solid #ccc;
            max-height: 180px;
            overflow-y: auto;
            display: none;
            border-radius: 8px;
            z-index: 1000;
        }
        .dropdown div {
            padding: 10px;
            cursor: pointer;
        }
        .dropdown div:hover { background: #f1f1f1; }
        button {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            background: #007BFF;
            color: white;
            cursor: pointer;
            margin-bottom: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        table, th, td { border: 1px solid #ccc; }
        th, td { padding: 10px; text-align: center; }
        th { background-color: #007BFF; color: white; }
        .no-bus { text-align: center; color: red; font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h3>Thrissur Bus Route Search</h3>

    <div class="input-group">
        <input type="text" id="source" placeholder="Enter Source">
        <div id="sourceDropdown" class="dropdown"></div>
    </div>

    <div class="input-group">
        <input type="text" id="destination" placeholder="Enter Destination">
        <div id="destinationDropdown" class="dropdown"></div>
    </div>

    <button onclick="searchRoute()">Search</button>

    <div id="busResult"></div>
</div>

<script>
// JSON data with live timings
const places = [
    "Thrissur","Guruvayur","Ollur","Chalakudy","Kodungallur","Irinjalakuda",
    "Wadakkanchery","Punkunnam","Kunnamkulam","Athani","Cherpu","Mannuthy",
    "Pavaratty","Viyyur","West Fort","East Fort"
];



const buses = [
    {
      "busNo": "101",
      "boarding": "Thrissur",
      "ending": "Chalakudy",
      "stops": ["Thrissur","Ollur","Chalakudy"],
      "timings": ["08:00","08:20","08:40"],
      "currentTimings": ["08:05","08:25","08:50"]
    },
    {
      "busNo": "102",
      "boarding": "Thrissur",
      "ending": "Kodungallur",
      "stops": ["Thrissur","Punkunnam","Kodungallur"],
      "timings": ["08:15","08:35","09:00"],
      "currentTimings": ["08:15","08:40","09:10"]
    },
    {
      "busNo": "103",
      "boarding": "Guruvayur",
      "ending": "Irinjalakuda",
      "stops": ["Guruvayur","Thrissur","Irinjalakuda"],
      "timings": ["07:50","08:30","09:00"],
      "currentTimings": ["07:55","08:35","09:05"]
    },
    {
      "busNo": "104",
      "boarding": "Punkunnam",
      "ending": "Mannuthy",
      "stops": ["Punkunnam","Athani","Mannuthy"],
      "timings": ["09:00","09:20","09:40"],
      "currentTimings": ["09:00","09:22","09:50"]
    },
    {
      "busNo": "105",
      "boarding": "Wadakkanchery",
      "ending": "Thrissur",
      "stops": ["Wadakkanchery","Kunnamkulam","Thrissur"],
      "timings": ["06:30","07:10","07:50"],
      "currentTimings": ["06:35","07:15","07:55"]
    },
    {
      "busNo": "106",
      "boarding": "Cherpu",
      "ending": "Pavaratty",
      "stops": ["Cherpu","Mannuthy","Pavaratty"],
      "timings": ["08:10","08:35","09:00"],
      "currentTimings": ["08:12","08:40","09:05"]
    },
    {
      "busNo": "107",
      "boarding": "Thrissur",
      "ending": "Guruvayur",
      "stops": ["Thrissur","Viyyur","Guruvayur"],
      "timings": ["07:30","07:50","08:20"],
      "currentTimings": ["07:32","07:55","08:25"]
    },
    {
      "busNo": "108",
      "boarding": "West Fort",
      "ending": "East Fort",
      "stops": ["West Fort","Thrissur","East Fort"],
      "timings": ["06:45","07:10","07:35"],
      "currentTimings": ["06:50","07:15","07:40"]
    }
];

// Autocomplete setup
function setupAutocomplete(inputId, dropdownId) {
    const input = document.getElementById(inputId);
    const dropdown = document.getElementById(dropdownId);

    input.addEventListener("focus", () => showDropdown(places));
    input.addEventListener("input", function () {
        const val = this.value.toLowerCase();
        const filtered = places.filter(p => p.toLowerCase().includes(val));
        showDropdown(filtered);
    });

    function showDropdown(list) {
        dropdown.innerHTML = "";
        if(list.length === 0) { dropdown.style.display="none"; return; }
        list.forEach(place => {
            const div = document.createElement("div");
            div.textContent = place;
            div.onclick = () => { input.value = place; dropdown.style.display="none"; };
            dropdown.appendChild(div);
        });
        dropdown.style.display = "block";
    }

    document.addEventListener("click", e => {
        if(!input.contains(e.target) && !dropdown.contains(e.target)){
            dropdown.style.display = "none";
        }
    });
}

setupAutocomplete("source", "sourceDropdown");
setupAutocomplete("destination", "destinationDropdown");

// Search function with delay info
function searchRoute() {
    const source = document.getElementById("source").value;
    const destination = document.getElementById("destination").value;
    const resultDiv = document.getElementById("busResult");
    resultDiv.innerHTML = "";

    if(!source || !destination){
        alert("Please enter both source and destination");
        return;
    }

    if(source === destination){
        alert("Source and destination cannot be the same.");
        return;
    }

    const availableBuses = [];

    buses.forEach(bus => {
        const srcIndex = bus.stops.indexOf(source);
        const destIndex = bus.stops.indexOf(destination);

        if(srcIndex !== -1 && destIndex !== -1 && srcIndex < destIndex){
            availableBuses.push({
                busNo: bus.busNo,
                boarding: bus.boarding,
                ending: bus.ending,
                srcScheduled: bus.timings[srcIndex],
                destScheduled: bus.timings[destIndex],
                srcCurrent: bus.currentTimings ? bus.currentTimings[srcIndex] : bus.timings[srcIndex],
                destCurrent: bus.currentTimings ? bus.currentTimings[destIndex] : bus.timings[destIndex]
            });
        }
    });

    if(availableBuses.length === 0){
        resultDiv.innerHTML = `<div class="no-bus">No buses found for this route</div>`;
        return;
    }

    let table = `<table>
                    <tr>
                        <th>Bus No</th>
                        <th>Boarding</th>
                        <th>Ending</th>
                        <th>${source}</th>
                        <th>${destination}</th>
                    </tr>`;

    availableBuses.forEach(bus => {
        let srcDisplay = bus.srcScheduled;
        if(bus.srcScheduled !== bus.srcCurrent){
            srcDisplay = `<span style="color:red">Delayed: ${bus.srcCurrent} (Scheduled: ${bus.srcScheduled})</span>`;
        }

        let destDisplay = bus.destScheduled;
        if(bus.destScheduled !== bus.destCurrent){
            destDisplay = `<span style="color:red">Delayed: ${bus.destCurrent} (Scheduled: ${bus.destScheduled})</span>`;
        }

        table += `<tr>
                    <td>${bus.busNo}</td>
                    <td>${bus.boarding}</td>
                    <td>${bus.ending}</td>
                    <td>${srcDisplay}</td>
                    <td>${destDisplay}</td>
                  </tr>`;
    });

    table += "</table>";
    resultDiv.innerHTML = table;
}
</script>

</body>
</html>